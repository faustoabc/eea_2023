## ----------------------------------------------------------------------------------------------------------------
library(tidyverse)


## ----------------------------------------------------------------------------------------------------------------
library(readxl)


## ----------------------------------------------------------------------------------------------------------------
eph_individual<- read_excel("C:/Users/faust/Desktop/2023/Maestría/EnfoqueEstadisticodelAprendizaje/Trabajo_Final/datasets/usu_individual_T223.xlsx")


## ----------------------------------------------------------------------------------------------------------------
eph_individual %>% head(5)


## ----------------------------------------------------------------------------------------------------------------
eph_hogares<- read_excel("C:/Users/faust/Desktop/2023/Maestría/EnfoqueEstadisticodelAprendizaje/Trabajo_Final/datasets/usu_hogar_T223.xlsx")


## ----------------------------------------------------------------------------------------------------------------
eph_hogares %>% head(5)


## ----------------------------------------------------------------------------------------------------------------
eph_individual<- eph_individual %>% select(CODUSU, NRO_HOGAR, CH03, PP08D1, CH06, 
                                           CH10, CH13, CH12, CH14)


## ----------------------------------------------------------------------------------------------------------------
# AÑOS DE EDUCACIÓN 
# Jardín/preescolar cuenta como 1 
eph_individual <- eph_individual %>% 
                        mutate(educacion = case_when(CH10 == 3 ~ 0, # Nunca asistió 
                                   CH06 < 2 ~ 0, # Menores de dos años 
                                   CH12 == 9 ~ 0,  # Educación especial 
                                   CH13 == 2 & CH12 == 1 ~ 0 # # Jardín/preescolar 
                                   )) 
 
# Primaria 
eph_individual <- eph_individual %>% 
  mutate(educacion = case_when( 
    CH13 == 2 & CH12 == 2 & CH14 == 0 ~ 1, 
    CH13 == 2 & CH12 == 2 & CH14 == 1 ~ 2, 
    CH13 == 2 & CH12 == 2 & CH14 == 2 ~ 3, 
    CH13 == 2 & CH12 == 2 & CH14 == 3 ~ 4, 
    CH13 == 2 & CH12 == 2 & CH14 == 4 ~ 5, 
    CH13 == 2 & CH12 == 2 & CH14 == 5 ~ 6, 
    CH13 == 2 & CH12 == 2 & CH14 == 6 ~ 7, 
    TRUE ~ educacion 
  )) 
 
# EGB 
eph_individual <- eph_individual %>% 
  mutate(educacion = case_when( 
    CH13 == 2 & CH12 == 3 & CH14 == 0 ~ 1, 
    CH13 == 2 & CH12 == 3 & CH14 == 1 ~ 2, 
    CH13 == 2 & CH12 == 3 & CH14 == 2 ~ 3, 
    CH13 == 2 & CH12 == 3 & CH14 == 3 ~ 4, 
    CH13== 2 & CH12 == 3 & CH14 == 4 ~ 5, 
    CH13 == 2 & CH12 == 3 & CH14 == 5 ~ 6, 
    CH13 == 2 & CH12 == 3 & CH14 == 6 ~ 7, 
    CH13 == 2 & CH12 == 3 & CH14 == 7 ~ 8, 
    CH13 == 2 & CH12 == 3 & CH14 == 8 ~ 9, 
    TRUE ~ educacion 
  )) 
 
# Secundaria 
eph_individual <- eph_individual %>% 
  mutate(educacion = case_when( 
    CH13 == 2 & CH12 == 4 & CH14 == 0 ~ 8, 
    CH13 == 2 & CH12 == 4 & CH14 == 1 ~ 9, 
    CH13 == 2 & CH12 == 4 & CH14 == 2 ~ 10, 
    CH13 == 2 & CH12 == 4 & CH14 == 3 ~ 11, 
    CH13 == 2 & CH12 == 4 & CH14 == 4 ~ 12, 
    CH13 == 2 & CH12 == 4 & CH14 == 5 ~ 13, 
    TRUE ~ educacion 
  )) 
 
# Resto de niveles educativos 
 
# Polimodal 
eph_individual <- eph_individual %>% 
  mutate(educacion = case_when( 
    CH13 == 2 & CH12 == 5 & CH14 == 0 ~ 10, 
    CH13 == 2 & CH12 == 5 & CH14 == 1 ~ 11, 
    CH13 == 2 & CH12 == 5 & CH14 == 2 ~ 12, 
    CH13 == 2 & CH12 == 5 & CH14 == 3 ~ 13, 
    TRUE ~ educacion 
  )) 
 
# Terciario 
eph_individual <- eph_individual %>% 
  mutate(educacion = case_when( 
    CH13 == 2 & CH12 == 6 & CH14 == 0 ~ 13, 
    CH13 == 2 & CH12 == 6 & CH14 == 1 ~ 14, 
    CH13 == 2 & CH12 == 6 & CH14 >= 2 & CH14 < 98 ~ 15, 
    TRUE ~ educacion 
  )) 
 
# Universitario 
eph_individual <- eph_individual %>% 
  mutate(educacion = case_when( 
    CH13 == 2 & CH12 == 7 & CH14 == 0 ~ 13, 
    CH13 == 2 & CH12 == 7 & CH14 == 1 ~ 14, 
    CH13 == 2 & CH12 == 7 & CH14 == 2 ~ 15, 
    CH13 == 2 & CH12 == 7 & CH14 == 3 ~ 16, 
    CH13 == 2 & CH12 == 7 & CH14 == 4 ~ 17, 
    CH13 == 2 & CH12 == 7 & CH14 >= 5 & CH14 < 98 ~ 18, 
    TRUE ~ educacion 
  )) 
 
# Posgrado 
eph_individual <- eph_individual %>% 
  mutate(educacion = case_when( 
    CH13 == 2 & CH12 == 8 & CH14 == 0 ~ 19, 
    CH13 == 2 & CH12 == 8 & CH14 == 1 ~ 20, 
    CH13 == 2 & CH12 == 8 & CH14 == 2 ~ 21, 
    CH13 == 2 & CH12 == 8 & CH14 >= 3 & CH14 < 98 ~ 22, 
    TRUE ~ educacion 
  )) 
 
# Completaron el nivel 
eph_individual <- eph_individual %>% 
  mutate(educacion = case_when( 
    CH13 == 1 & CH12 == 1 ~ 1, 
    CH13 == 1 & CH12 == 2 ~ 8, 
    CH13 == 1 & CH12 == 3 ~ 11, 
    CH13 == 1 & (CH12 == 4 | CH12 == 5) ~ 13, 
    CH13 == 1 & CH12 == 6 ~ 16, 
    CH13 == 1 & CH12 == 7 ~ 19, 
    CH13 == 1 & CH12 == 8 ~ 23, 
    TRUE ~ educacion 
  )) 


## ----------------------------------------------------------------------------------------------------------------
eph_individual<- eph_individual %>% filter(!is.na(educacion))


## ----------------------------------------------------------------------------------------------------------------
eph_hogares<- eph_hogares %>% select(CODUSU, NRO_HOGAR, IV2, IX_TOT) %>% mutate(personas_por_amb= IX_TOT/IV2)


## ----------------------------------------------------------------------------------------------------------------
eph_cons<- eph_individual %>% left_join(., eph_hogares, by= c("CODUSU", "NRO_HOGAR"))


## ----------------------------------------------------------------------------------------------------------------
eph_padre<- eph_cons %>% filter(CH03== 06) 


## ----------------------------------------------------------------------------------------------------------------
eph_hijo<- eph_cons %>% filter(CH03== 03 & PP08D1> 0)


## ----------------------------------------------------------------------------------------------------------------
eph_jefe<- eph_cons %>% filter(CH03== 01 & PP08D1> 0)


## ----------------------------------------------------------------------------------------------------------------
eph<- eph_hijo %>% left_join(., eph_jefe, by= c("CODUSU", "NRO_HOGAR"))


## ----------------------------------------------------------------------------------------------------------------
eph<- eph %>% left_join(., eph_padre, by= c("CODUSU", "NRO_HOGAR"))


## ----------------------------------------------------------------------------------------------------------------
eph <- eph %>% filter(!is.na(educacion.y) | !is.na(educacion))


## ----------------------------------------------------------------------------------------------------------------
eph<- eph %>% mutate(educacion= replace_na(educacion, 0)) %>% mutate(educacion.y=
                                                                       replace_na(educacion.y, 0))


## ----------------------------------------------------------------------------------------------------------------
eph<- eph %>% mutate(educ_padre= educacion.y + educacion)


## ----------------------------------------------------------------------------------------------------------------
eph<- eph %>% select(CODUSU, NRO_HOGAR, PP08D1.x, personas_por_amb.x, educacion.x, educ_padre) 


## ----------------------------------------------------------------------------------------------------------------
eph<- eph %>% rename(ingreso= PP08D1.x) %>% rename(personas_por_amb= personas_por_amb.x) %>% rename (educ= educacion.x)


## ----------------------------------------------------------------------------------------------------------------
hist(eph$ingreso)


## ----------------------------------------------------------------------------------------------------------------
hist(log(eph$ingreso))


## ----------------------------------------------------------------------------------------------------------------
modelo_1<- lm(log(ingreso) ~ educ, data= eph)


## ----------------------------------------------------------------------------------------------------------------
summary(modelo_1)


## ----------------------------------------------------------------------------------------------------------------
plot(modelo_1)


## ----------------------------------------------------------------------------------------------------------------
hist(eph$educ)


## ----------------------------------------------------------------------------------------------------------------
hist(eph$educ_padre)


## ----------------------------------------------------------------------------------------------------------------
library(corrr)

cor.test(eph$educ, eph$educ_padre, method="spearman")


## ----------------------------------------------------------------------------------------------------------------
library(ivreg)


## ----------------------------------------------------------------------------------------------------------------
modelo_2 <- ivreg(log(ingreso)~ educ | educ_padre , data = eph)


## ----------------------------------------------------------------------------------------------------------------
summary(modelo_2)


## ----------------------------------------------------------------------------------------------------------------
plot(modelo_2)


## ----------------------------------------------------------------------------------------------------------------
modelo_2_paso_1<- lm(educ~ educ_padre, data=eph)


## ----------------------------------------------------------------------------------------------------------------
summary(modelo_2_paso_1)


## ----------------------------------------------------------------------------------------------------------------
educ_predichos<- predict(modelo_2_paso_1)


## ----------------------------------------------------------------------------------------------------------------
modelo_2_paso_2<- lm(log(ingreso) ~ valores_predichos, data= eph)


## ----------------------------------------------------------------------------------------------------------------
summary(modelo_2_paso_2)


## ----------------------------------------------------------------------------------------------------------------
hist(eph$personas_por_amb)


## ----------------------------------------------------------------------------------------------------------------
library(corrr)

cor.test(eph$educ, eph$personas_por_amb, method="spearman")


## ----------------------------------------------------------------------------------------------------------------
modelo_3 <- ivreg(log(ingreso)~ educ | personas_por_amb , data = eph)


## ----------------------------------------------------------------------------------------------------------------
summary(modelo_3)


## ----------------------------------------------------------------------------------------------------------------
plot(modelo_3)


## ----------------------------------------------------------------------------------------------------------------
library(broom)


## ----------------------------------------------------------------------------------------------------------------
modelos<- list(MCO= modelo_1, MC2E_1= modelo_2, MC2E_2= modelo_3)



## ----------------------------------------------------------------------------------------------------------------
map_df(modelos, tidy, .id= "modelo")


